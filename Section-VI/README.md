# Створення за допомогою Jenkins в середині ефемерного контейнера Docker

Різні підходи до запуску збірок із Дженкінсом усередині контейнерів

Які рішення ми прийняли як команда і чому

Уроки, які ми отримали під час роботи з нашою платформою

Контекст для детального підручника про те, як створити власні ефемерні середовища збірки за допомогою Jenkins

Як створити це налаштування, якщо ви хочете використовувати його як свій основний сервер Jenkins замість локального сервера розробки

Мислення всередині контейнера також означає створення всередині нього. Сьогодні я хотів би розповісти про те, як моя команда зараз об’єднує Jenkins і Docker для обслуговування команд Riot Engineering. У відповідній публікації я пообіцяв, що обговорю фактичну підлеглу збірку та конфігурацію Jenkins безпосередньо. У певному сенсі це головна подія — якщо у вас немає сервера Jenkins, готового приймати підлеглі пристрої, варто повернутися до попередніх публікацій . 

Однак перед тим, як розпочати навчальний посібник, давайте поговоримо про підхід та альтернативи. Існує багато способів використання контейнерів Docker як підлеглих пристроїв. Навіть звужуючи поле до простого використання їх на Jenkins, все одно є багато варіантів. Завдяки моїм дослідженням і відкриттям я вважаю, що ви можете застосувати два основні підходи. Концептуально я буду називати їх моделями «виконання Docker» і «Ephemeral Slave» Docker.

Ці два підходи мають коріння в тому, як Дженкінс підключається та спілкується з вашим підлеглим комп’ютером. У моделі виконання Jenkins підключається традиційним способом: запускаючи агент на існуючій віртуальній машині або фізичному обладнанні, де він очікує запущений хост Docker. У ефемерній моделі Дженкінс безпосередньо підключається до контейнера Docker і розглядає його як підлеглий комп’ютер. Різниця між двома варіантами є важливою, тому давайте трохи розберемо кожен із них. 

# МОДЕЛЬ ВИКОНАННЯ DOCKER

У моделі виконання ми архітектурно припускаємо, що підлеглий пристрій є хостом Docker, але розглядаємо його як фізичну машину. Коли запускається завдання Дженкінса, воно синхронізує/створює робочий каталог безпосередньо на підлеглому пристрої, використовує команди docker run і docker exec для запуску контейнера, а потім монтує його локальний робочий простір усередині. Контейнер є віртуальним блокнотом і ізольованим середовищем. Він може містити всі спеціальні версії інструментів і двійкових файлів, які нам потрібні для компіляції вихідного коду, який ми змонтували в контейнер.

Після завершення роботи зі збирання всі створені ним двійкові файли та артефакти збірки будуть на підпорядкованому пристрої в традиційному робочому просторі Jenkins. Дженкінс може безпечно вимкнути контейнер і виконати будь-яке очищення після збирання, як зазвичай.

Цю модель найкраще представляє Cloudbees Custom Build Environment Plugin , який є відкритим кодом і підтримується власниками сховища вихідних кодів Jenkins. 

