# РОЗДІЛ II

# Розміщення Jenkins в контейнері Docker 

# I. ПІДГОТОВКА СЕРЕДОВИЩЯ

1. Перейдіть на сторінку: https://www.docker.com/docker-mac або https://www.docker.com/docker-windows 
2. Завантажте та встановіть відповідну версію Docker для вашої операційної системи
3. Дотримуйтеся всіх інструкцій із налаштування.

Перевірте наступні команди та переконайтеся, що ви не отримуєте жодних помилок 

    docker ps

    docker info

Перш ніж робити щось інше, нам слід збільшити стандартні параметри пам’яті та ЦП, які використовує Docker. Пізніше ми збираємося налаштувати Jenkins, щоб використовувати більше пам’яті, і якщо ми не налаштуємо ці параметри спочатку, Jenkins може вийти з ладу.

    Перейдіть до свого віджета Docker на панелі інструментів і виберіть «Налаштування»

    Перейдіть на вкладку «Додаткова конфігурація».

    Збільште використання ЦП принаймні до 4 ядер

Збільште використання пам’яті принаймні до 8 ГБ, бажано більше, приблизно до 12 ГБ для безпеки (якщо вона у вас є) 

# II. СТВОРИТИ ТА ЗАПУСТИТИ КОНТЕЙНЕР CLOUDBEES JENKINS

1. Залишайтеся у вікні терміналу Docker
2. Витягніть Jenkins із публічного репо, виконавши
    
    docker pull jenkins/jenkins

    docker run -p 8080:8080 --name=jenkins-master jenkins/jenkins

3. Зауважте, що повідомлення «Початкове налаштування Jenkins» у вікні оболонки створить для вас пароль. Запишіть це, оскільки воно вам знадобиться пізніше. Якщо ви втратите його, ви можете запустити `docker exec jenkins-master cat /var/jenkins_home/secrets/initialAdminPassword` із запущеним контейнером, щоб отримати його.
4. Відкрийте свій улюблений браузер і вкажіть у ньому http://localhost:8080

Будь ласка, зверніть увагу, ви побачите, що я використовую прапорець Docker --name і називаю контейнер jenkins-master – це угода, яку я використовуватиму в цьому блозі. Присвоєння імен вашим контейнерам є зручною найкращою практикою, яка має три переваги:

1. Це полегшує їх запам’ятовування та взаємодію
2. Docker не дозволяє двом контейнерам мати однакову назву, що запобігає помилкам, таким як випадковий запуск двох ідентичних
3. Багато звичайних інструментів Docker (наприклад, Docker Compose) використовують конкретні назви контейнерів, тому звикнути називати контейнери — це хороша практика. 

# III. ПРАКТИЧНІ КРОКИ ДЕМОНІЗАЦІЯ, НАЛАШТУВАННЯ ПАМ'ЯТІ, ЗБІЛЬШЕННЯ ПУЛУ ПІДКЛЮЧЕННЯ

Попередній крок запускає Jenkins із найпростішими параметрами запуску. Ви навіть бачите, що Jenkins потребує базової конфігурації та просить вас ввести пароль адміністратора (який можна отримати з журналів, які відображаються на екрані під час запуску). Якщо ви схожі на Riot, навряд чи ви запускаєте Jenkins із налаштуваннями за замовчуванням. Розглянемо додавання деяких корисних опцій. Ми поки що не будемо налаштовувати Jenkins; достатньо знати, що він може запускатися і працювати. 

ДЕМОНІЗАЦІЯ

Використовуйте прапор -d Docker, щоб запустити контейнер.

    docker rm jenkins-master

    docker run -p 8080:8080 --name=jenkins-master -d jenkins/jenkins

Тепер вам має бути просто відображено хеш-рядок і ви повернетесь до свого терміналу. Якщо ви новачок у Docker, цей хеш-рядок насправді є унікальним ідентифікатором вашого контейнера (корисно, якщо ви починаєте автоматизувати ці команди).

НАЛАШТУВАННЯ ПАМ'ЯТІ

Використовуємо наступне:

    docker stop jenkins-master

    docker rm jenkins-master

    docker run -p 8080:8080 --name=jenkins-master -d --env JAVA_OPTS="-Xmx8192m" --env JENKINS_OPTS=" --handlerCountMax=300" jenkins/jenkins

Це дасть Дженкінсу хороший базовий пул обробників і обмеження. Випадково тепер ви навчилися використовувати як JAVA OPTS, так і JENKINS OPTS як змінні середовища. Зауважте, що це працює через те, як Cloudbees зручно структурував свій Jenkins Dockerfile.
